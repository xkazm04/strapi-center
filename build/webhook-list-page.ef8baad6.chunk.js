"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[4121],{6784:(We,B,o)=>{o.r(B),o.d(B,{default:()=>be});var e=o(53547),i=o(68547),P=o(87751),W=o(49656),U=o(97132),v=o(35395),j=o(92543),z=o(40264),Z=o(9524),M=o(49549),x=o(46458),r=o(43546),f=o(33483),A=o(64459),J=o(19631),Q=o(36825),X=o(80117),Y=o(67422),q=o(94117),_=o(89326),w=o.n(_),ee=o(56204),te=o.n(ee),oe=o(62982),H=o.n(oe),ne=o(26485),le=o.n(ne),ae=o(73749),se=o(36968),ie=o.n(se);const re={webhooks:[],webhooksToDelete:[],webhookToDelete:null,loadingWebhooks:!0},de=(a,l)=>(0,ae.default)(a,n=>{switch(l.type){case"GET_DATA_SUCCEEDED":{n.webhooks=l.data,n.loadingWebhooks=!1;break}case"TOGGLE_LOADING":{n.loadingWebhooks=!a.loadingWebhooks;break}case"SET_WEBHOOK_ENABLED":{ie()(n,["webhooks",...l.keys],l.value);break}case"SET_WEBHOOK_TO_DELETE":{n.webhookToDelete=l.id;break}case"SET_WEBHOOKS_TO_DELETE":{l.value?n.webhooksToDelete.push(l.id):n.webhooksToDelete=a.webhooksToDelete.filter(d=>d!==l.id);break}case"SET_ALL_WEBHOOKS_TO_DELETE":{a.webhooksToDelete.length===0?n.webhooksToDelete=a.webhooks.map(d=>d.id):n.webhooksToDelete=[];break}case"WEBHOOKS_DELETED":{n.webhooks=a.webhooks.filter(d=>!a.webhooksToDelete.includes(d.id)),n.webhooksToDelete=[];break}case"WEBHOOK_DELETED":{n.webhooks=a.webhooks.filter((d,g)=>g!==l.index),n.webhookToDelete=null;break}default:return n}});var ce=o(25108),ue=Object.defineProperty,Ee=Object.defineProperties,he=Object.getOwnPropertyDescriptors,I=Object.getOwnPropertySymbols,me=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable,K=(a,l,n)=>l in a?ue(a,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[l]=n,b=(a,l)=>{for(var n in l||(l={}))me.call(l,n)&&K(a,n,l[n]);if(I)for(var n of I(l))ge.call(l,n)&&K(a,n,l[n]);return a},fe=(a,l)=>Ee(a,he(l)),p=(a,l,n)=>new Promise((d,g)=>{var T=E=>{try{s(n.next(E))}catch(m){g(m)}},u=E=>{try{s(n.throw(E))}catch(m){g(m)}},s=E=>E.done?d(E.value):Promise.resolve(E.value).then(T,u);s((n=n.apply(a,l)).next())});const Te=()=>{const{isLoading:a,allowedActions:{canCreate:l,canRead:n,canUpdate:d,canDelete:g}}=(0,i.useRBAC)(P.Z.settings.webhooks),T=(0,i.useNotification)(),u=(0,e.useRef)(!0),{formatMessage:s}=(0,U.useIntl)(),[E,m]=(0,e.useState)(!1),[{webhooks:D,webhooksToDelete:O,webhookToDelete:C,loadingWebhooks:S},h]=(0,e.useReducer)(de,re),{notifyStatus:ye}=(0,Y.useNotifyAT)();(0,i.useFocusWhenNavigate)();const{push:ve}=(0,W.useHistory)(),{pathname:N}=(0,W.useLocation)(),L=D.length,y=O.length,V=t=>D.findIndex(c=>c.id===t);(0,e.useEffect)(()=>(u.current=!0,()=>{u.current=!1}),[]),(0,e.useEffect)(()=>{n&&pe()},[n]);const pe=()=>p(void 0,null,function*(){try{const{data:t}=yield(0,i.request)("/admin/webhooks",{method:"GET"});u.current&&(h({type:"GET_DATA_SUCCEEDED",data:t}),ye("webhooks have been loaded"))}catch(t){ce.log(t),u.current&&(t.code!==20&&T({type:"warning",message:{id:"notification.error"}}),h({type:"TOGGLE_LOADING"}))}}),De=()=>{m(t=>!t)},Oe=()=>{C?Le():ke()},Le=()=>p(void 0,null,function*(){try{yield(0,i.request)(`/admin/webhooks/${C}`,{method:"DELETE"}),h({type:"WEBHOOK_DELETED",index:V(C)})}catch(t){t.code!==20&&T({type:"warning",message:{id:"notification.error"}})}m(!1)}),ke=()=>p(void 0,null,function*(){const t={ids:O};try{yield(0,i.request)("/admin/webhooks/batch-delete",{method:"POST",body:t}),u.current&&h({type:"WEBHOOKS_DELETED"})}catch(c){u.current&&c.code!==20&&T({type:"warning",message:{id:"notification.error"}})}m(!1)}),G=t=>{m(!0),t!=="all"&&h({type:"SET_WEBHOOK_TO_DELETE",id:t})},we=(t,c)=>p(void 0,null,function*(){const $=V(c),Be=D[$],R=[$,"isEnabled"],F=fe(b({},Be),{isEnabled:t});delete F.id;try{h({type:"SET_WEBHOOK_ENABLED",keys:R,value:t}),yield(0,i.request)(`/admin/webhooks/${c}`,{method:"PUT",body:F})}catch(Pe){u.current&&(h({type:"SET_WEBHOOK_ENABLED",keys:R,value:!t}),Pe.code!==20&&T({type:"warning",message:{id:"notification.error"}}))}}),Ce=()=>{h({type:"SET_ALL_WEBHOOKS_TO_DELETE"})},Se=(t,c)=>{h({type:"SET_WEBHOOKS_TO_DELETE",value:t,id:c})},k=t=>{ve(`${N}/${t}`)};return e.createElement(v.Layout,null,e.createElement(i.SettingsPageTitle,{name:"Webhooks"}),e.createElement(X.Main,{"aria-busy":a||S},e.createElement(v.HeaderLayout,{title:s({id:"Settings.webhooks.title",defaultMessage:"Webhooks"}),subtitle:s({id:"Settings.webhooks.list.description",defaultMessage:"Get POST changes notifications"}),primaryAction:l&&!S&&e.createElement(i.LinkButton,{startIcon:e.createElement(w(),null),variant:"default",to:`${N}/create`,size:"L"},s({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))}),y>0&&g&&e.createElement(v.ActionLayout,{startActions:e.createElement(e.Fragment,null,e.createElement(f.Typography,{variant:"epsilon",textColor:"neutral600"},s({id:"Settings.webhooks.to.delete",defaultMessage:"{webhooksToDeleteLength, plural, one {# asset} other {# assets}} selected"},{webhooksToDeleteLength:y})),e.createElement(A.Button,{onClick:()=>G("all"),startIcon:e.createElement(H(),null),size:"L",variant:"danger-light"},s({id:"global.delete",defaultMessage:"Delete"})))}),e.createElement(v.ContentLayout,null,a||S?e.createElement(q.Box,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(i.LoadingIndicatorPage,null)):e.createElement(e.Fragment,null,L>0?e.createElement(r.Table,{colCount:5,rowCount:L+1,footer:e.createElement(r.TFooter,{onClick:()=>l?k("create"):{},icon:e.createElement(w(),null)},s({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))},e.createElement(r.Thead,null,e.createElement(r.Tr,null,e.createElement(r.Th,null,e.createElement(x.BaseCheckbox,{"aria-label":s({id:"global.select-all-entries",defaultMessage:"Select all entries"}),indeterminate:y>0&&y<L,value:y===L,onValueChange:Ce})),e.createElement(r.Th,{width:"20%"},e.createElement(f.Typography,{variant:"sigma",textColor:"neutral600"},s({id:"global.name",defaultMessage:"Name"}))),e.createElement(r.Th,{width:"60%"},e.createElement(f.Typography,{variant:"sigma",textColor:"neutral600"},s({id:"Settings.webhooks.form.url",defaultMessage:"URL"}))),e.createElement(r.Th,{width:"20%"},e.createElement(f.Typography,{variant:"sigma",textColor:"neutral600"},s({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"}))),e.createElement(r.Th,null,e.createElement(J.VisuallyHidden,null,s({id:"Settings.webhooks.list.th.actions",defaultMessage:"Actions"}))))),e.createElement(r.Tbody,null,D.map(t=>e.createElement(r.Tr,b({key:t.id},(0,i.onRowClick)({fn:()=>k(t.id),condition:d})),e.createElement(r.Td,b({},i.stopPropagation),e.createElement(x.BaseCheckbox,{"aria-label":`${s({id:"global.select",defaultMessage:"Select"})} ${t.name}`,value:O==null?void 0:O.includes(t.id),onValueChange:c=>Se(c,t.id),id:"select",name:"select"})),e.createElement(r.Td,null,e.createElement(f.Typography,{fontWeight:"semiBold",textColor:"neutral800"},t.name)),e.createElement(r.Td,null,e.createElement(f.Typography,{textColor:"neutral800"},t.url)),e.createElement(r.Td,null,e.createElement(z.Flex,b({},i.stopPropagation),e.createElement(Q.Switch,{onLabel:s({id:"global.enabled",defaultMessage:"Enabled"}),offLabel:s({id:"global.disabled",defaultMessage:"Disabled"}),label:`${t.name} ${s({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"})}`,selected:t.isEnabled,onChange:()=>we(!t.isEnabled,t.id),visibleLabels:!0}))),e.createElement(r.Td,null,e.createElement(Z.Stack,b({horizontal:!0,spacing:1},i.stopPropagation),d&&e.createElement(M.IconButton,{onClick:()=>{k(t.id)},label:s({id:"Settings.webhooks.events.update",defaultMessage:"Update"}),icon:e.createElement(te(),null),noBorder:!0}),g&&e.createElement(M.IconButton,{onClick:()=>G(t.id),label:s({id:"global.delete",defaultMessage:"Delete"}),icon:e.createElement(H(),null),noBorder:!0,id:`delete-${t.id}`}))))))):e.createElement(j.EmptyStateLayout,{icon:e.createElement(le(),{width:"160px"}),content:s({id:"Settings.webhooks.list.empty.description",defaultMessage:"No webhooks found"}),action:e.createElement(A.Button,{variant:"secondary",startIcon:e.createElement(w(),null),onClick:()=>l?k("create"):{}},s({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))})))),e.createElement(i.ConfirmDialog,{isOpen:E,onToggleDialog:De,onConfirm:Oe}))},be=()=>e.createElement(i.CheckPagePermissions,{permissions:P.Z.settings.webhooks.main},e.createElement(Te,null))}}]);
