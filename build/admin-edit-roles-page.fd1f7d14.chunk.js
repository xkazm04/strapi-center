"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[2544],{50287:(ne,L,t)=>{t.r(L),t.d(L,{default:()=>w});var e=t(53547),o=t(68547),M=t(49656),B=t(92699),u=t(94117),x=t(64459),T=t(35395),j=t(80117),y=t(9524),G=t(80831),N=t(56156),Z=t(87760),z=t.n(Z),O=t(27361),C=t.n(O),b=t(97132),$=t(79160),S=t(39272),H=t(40264),A=t(33483),V=t(78607),W=t(99136),J=t(45697),g=t.n(J);const R=({disabled:r,role:a,values:n,errors:i,onChange:d,onBlur:c})=>{const{formatMessage:s}=(0,b.useIntl)();return e.createElement(e.Fragment,null,e.createElement(u.Box,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(y.Stack,{spacing:4},e.createElement(H.Flex,{justifyContent:"space-between"},e.createElement(u.Box,null,e.createElement(u.Box,null,e.createElement(A.Typography,{fontWeight:"bold"},a?a.name:s({id:"global.details",defaultMessage:"Details"}))),e.createElement(u.Box,null,e.createElement(A.Typography,{textColor:"neutral500",variant:"pi"},a?a.description:s({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(x.Button,{disabled:!0,variant:"secondary"},s({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:a.usersCount}))),e.createElement(S.Grid,{gap:4},e.createElement(S.GridItem,{col:6},e.createElement(W.TextInput,{disabled:r,name:"name",error:i.name&&s({id:i.name}),label:s({id:"global.name",defaultMessage:"Name"}),onChange:d,onBlur:c,value:n.name||""})),e.createElement(S.GridItem,{col:6},e.createElement(V.Textarea,{disabled:r,label:s({id:"global.description",defaultMessage:"Description"}),name:"description",error:i.name&&s({id:i.name}),onChange:d,onBlur:c},n.description||""))))))};R.defaultProps={disabled:!1,role:null,values:{name:"",description:""}},R.propTypes={disabled:g().bool,errors:g().object.isRequired,onBlur:g().func.isRequired,onChange:g().func.isRequired,role:g().object,values:g().object};const K=R;var I=t(32104),F=t(63600);const Q=F.Ry().shape({name:F.Z_().required(o.translatedErrors.required)});var X=t(25108),Y=(r,a,n)=>new Promise((i,d)=>{var c=l=>{try{v(n.next(l))}catch(E){d(E)}},s=l=>{try{v(n.throw(l))}catch(E){d(E)}},v=l=>l.done?i(l.value):Promise.resolve(l.value).then(c,s);v((n=n.apply(r,a)).next())});const k=()=>{const r=(0,o.useNotification)(),{formatMessage:a}=(0,b.useIntl)(),{params:{id:n}}=(0,M.useRouteMatch)("/settings/roles/:id"),[i,d]=(0,e.useState)(!1),c=(0,e.useRef)(),{lockApp:s,unlockApp:v}=(0,o.useOverlayBlocker)(),{trackUsage:l}=(0,o.useTracking)(),{isLoading:E,data:q}=(0,I.U_)(n),{role:p,permissions:_,isLoading:U,onSubmitSucceeded:ee}=(0,I.Dq)(n),te=f=>Y(void 0,null,function*(){try{s(),d(!0);const{permissionsToSend:m,didUpdateConditions:h}=c.current.getPermissions();yield(0,o.request)(`/admin/roles/${n}`,{method:"PUT",body:f}),p.code!=="strapi-super-admin"&&(yield(0,o.request)(`/admin/roles/${n}/permissions`,{method:"PUT",body:{permissions:m}}),h&&l("didUpdateConditions")),c.current.setFormAfterSubmit(),ee({name:f.name,description:f.description}),r({type:"success",message:{id:"notification.success.saved"}})}catch(m){X.error(m.response);const h=C()(m,"response.payload.message","An error occured"),P=C()(m,"response.payload.data.permissions[0]",h);r({type:"warning",message:P})}finally{d(!1),v()}}),D=p.code==="strapi-super-admin";return e.createElement(j.Main,null,e.createElement(o.SettingsPageTitle,{name:"Roles"}),e.createElement(G.Formik,{enableReinitialize:!0,initialValues:{name:p.name,description:p.description},onSubmit:te,validationSchema:Q,validateOnChange:!1},({handleSubmit:f,values:m,errors:h,handleChange:P,handleBlur:ae})=>e.createElement("form",{onSubmit:f},e.createElement(e.Fragment,null,e.createElement(T.HeaderLayout,{primaryAction:e.createElement(y.Stack,{horizontal:!0,spacing:2},e.createElement(x.Button,{disabled:p.code==="strapi-super-admin",onClick:f,loading:i,size:"L"},a({id:"global.save",defaultMessage:"Save"}))),title:a({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:a({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(N.Link,{startIcon:e.createElement(z(),null),to:"/settings/roles"},a({id:"global.back",defaultMessage:"Back"}))}),e.createElement(T.ContentLayout,null,e.createElement(y.Stack,{spacing:6},e.createElement(K,{isLoading:U,disabled:D,errors:h,values:m,onChange:P,onBlur:ae,role:p}),!E&&!U?e.createElement(u.Box,{shadow:"filterShadow",hasRadius:!0},e.createElement($.Z,{isFormDisabled:D,permissions:_,ref:c,layout:q})):e.createElement(u.Box,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(o.LoadingIndicatorPage,null))))))))},w=()=>{const r=(0,e.useMemo)(()=>({read:B.Z.settings.roles.read,update:B.Z.settings.roles.update}),[]),{isLoading:a,allowedActions:{canRead:n,canUpdate:i}}=(0,o.useRBAC)(r);return a?e.createElement(o.LoadingIndicatorPage,null):!n&&!i?e.createElement(M.Redirect,{to:"/"}):e.createElement(k,null)}}}]);
